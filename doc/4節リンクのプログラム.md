# 4節リンクの歩行を検討する

2足歩行の検討に使用することができて、実機に拡張可能なプログラムを作成する。

## 4節リンクモデル

`リンク`は`長さ`を持つ直線で、両端に`原点`と`反原点`がある。
リンクは原点と反原点の間に`複数のピン`を持ち、`他のリンクと繋がっている`。

接点を軸にしてリンクは`回転可能`で、`回転角度に制限`を持たせることができる。
`固定ピン`は`世界座標`上に固定されていて、座標は変更されない。
`回転不可`に設定されたピンにつながっているリンクは回転できない。

`駆動ピン`と固定ピンに設定されたピンを持つリンクは、駆動ピンを中心に自発的に自身の角度を変更して、他のリンクの座標や角度に影響を与える。

`駆動ピン`で`固定ピンではない`ピンは、駆動ピンを中心に自発的に角度と自身のピンの位置を変更して、他のリンクの座標や角度に影響を与える。
（処理が煩雑になるので、直近はこの組合せの駆動リンクを作成しない）

`固定ピン`を2つ以上持つリンクは角度や位置を変更できない固定軸となる。


<img src = 4節リンクのプログラムを検討.drawio.png>

>直近は駆動軸は世界座標に固定されて、他のリンクの動きに影響を与えるだけとする。
固定されてないリンクには駆動軸を設定しない。
実装の難易度を低くするため。

## 4節リンクのクラス図

```mermaid

classDiagram


class CFourBarLinkage_4節リンク {
  CLink_リンクへのポインタリスト
}


class CLink_リンク { 

  -float fLen:長さ

  -bool enable_drive: 駆動可能/不可能
  -float org_x,org_y: 原点座標
  -float oop_x,oop_y: 反原点座標


}

class CPin_ピン {
    -float x,y: 原点からの座標 y=0
    -CLink* : 他のリンクに繋がっている
    -bool enable_rotation : 回転可能/回転不可
    -bool is_fixed : 固定ピンである/固定ピンではない
    -bool is_drive : 駆動ピンである/駆動ピンではない
}


class CPin {
    offset: float : 親座標からのオフセット
    degree: float : 親座標との角度
    enable_rotation: bool : 回転可能/回転不可
    is_fixed: bool : 固定ピンである/固定ピンではない
    is_drive: bool : 駆動ピンである/駆動ピンではない
    parent_pos: Tuple[float, float] : 親座標
    
    __init__(offset: float, degree: float, enable_rotation: bool = True, is_fixed: bool = True, is_drive: bool = True)
    set_parent_pos(pos: Tuple[float, float]) : 親座標の設定
    set_degree(degree: float)
    calculate()
    draw(img: numpy.ndarray)
}


CLink_リンク "1"* --"1..*" CPin_ピン : composition
CFourBarLinkage_4節リンク "1"o--"1..*" CLink_リンク : Aggregation

```

https://zenn.dev/tak_uchida/articles/da583cf960e854